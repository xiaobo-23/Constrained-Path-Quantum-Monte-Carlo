!$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
!____________________________________ Begin subroutine __________________________________________________________________
!________________________________________________________________________________________________________________________
	subroutine CPMCInitiate()
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%     
! PROGRAM:  CPMCInitiate()
! TYPE:     subroutine
! PURPOSE:  This Subroutine is used to perform the CPMC initialization before the whole CPMC simulation.
! KEYWORDS: CPMC initialization.
! AUTHOR:   Yuan-Yao He
! TIME:     2020-02-27
! DESCRIPTION:
!
!     Input:  (none)   Output: (none)
!                  
! END PROGRAM
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   
!______________________________________________________________________________________________________________	  
!_________________________________________ Modules used in this subroutine ____________________________________
!______________________________________________________________________________________________________________ 
		use MPISetting
		implicit none
!______________________________________________________________________________________________________________	  
!______________________________ Temperory Quantities used in the calculations _________________________________
!______________________________________________________________________________________________________________
		integer(8) time1 
		integer(8) time2	
!______________________________________________________________________________________________________________	  
!_______________________________ Main calculations of CPMC Initialization _____________________________________
!______________________________________________________________________________________________________________
!&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(
!_________________________ Monitor output of CPMCInitiate process _________________________________
!&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(
      if(amyid == amstr) then
         write(*, "(A)") "+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++"
         write(*, "(2x, 'CPMCInitiate: Initialization for the CPMC simulation!')")
      end if
!**************************************************************************************************	  
!___________________ 0. Random number initialization, MPI and Preprocessors for simulation ________
!**************************************************************************************************
      call SubroutineBgn("InitRandPrep", 11, time1)
		call InitRandPrep()
      call SubroutineEnd("InitRandPrep", 11, time1, time2) 
!**************************************************************************************************	  
!___________________ 1. Initialization of the finite lattice of the system ________________________
!**************************************************************************************************
      call SubroutineBgn("InitLattStru", 11, time1)
		call InitLattStru()
      call SubroutineEnd("InitLattStru", 11, time1, time2) 
!**************************************************************************************************  
!___________________ 2. Initialization of trial Hamiltonain H_T matrix ____________________________
!**************************************************************************************************      
      call SubroutineBgn("InitTrialHmt", 11, time1)
      call InitTrialHmt()
      call SubroutineEnd("InitTrialHmt", 11, time1, time2)      
!**************************************************************************************************  
!___________________ 3. Initialization of exponential kinetic matrices ____________________________
!**************************************************************************************************      
      call SubroutineBgn("InitExpHmltK", 11, time1)
      call InitExpHmltK()
      call SubroutineEnd("InitExpHmltK", 11, time1, time2)
!**************************************************************************************************	  
!___________________ 4. Initialization of exponential interaction related quantities ______________
!**************************************************************************************************
      call SubroutineBgn("InitExpHmltV", 11, time1)
		call InitExpHmltV()
      call SubroutineEnd("InitExpHmltV", 11, time1, time2)
!**************************************************************************************************	  
!___________________ 5. Initialization of Core CPMC vectors and matrices __________________________
!**************************************************************************************************
      call SubroutineBgn("InitCoreVcMt", 11, time1)
		call InitCoreVcMt()
      call SubroutineEnd("InitCoreVcMt", 11, time1, time2)
!**************************************************************************************************  
!___________________ 6. Initialization of all physical observables ________________________________
!************************************************************************************************** 
      call SubroutineBgn("InitPhyObsev", 11, time1)
		call InitPhyObsev()
      call SubroutineEnd("InitPhyObsev", 11, time1, time2)
!**************************************************************************************************  
!___________________ 7. List all the calcaulation constants _______________________________________
!**************************************************************************************************
      call SubroutineBgn("InitListCons", 11, time1)
		call InitListCons()
      call SubroutineEnd("InitListCons", 11, time1, time2)
!**************************************************************************************************	  
!___________________ 8. Initialization of output files handles for the CPMC calculated data _______
!**************************************************************************************************
      call SubroutineBgn("InitMCOutput", 11, time1)
		call InitMCOutput()
      call SubroutineEnd("InitMCOutput", 11, time1, time2)
!&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(
!_________________________ Monitor output of CPMCInitiate process _________________________________
!&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(      
      if(amyid == amstr) then
         write(*, "(A)") "+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++"
         write(*, "()")
         write(*, "()")
      end if
		
	end subroutine CPMCInitiate
!________________________________________________________________________________________________________________________  
!____________________________________ End subroutine ____________________________________________________________________
!$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$